<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <div class="card tab2-card">
          <!-- <div class="card-header">
                        <h5> Add User</h5>
                    </div> -->
          <form class="card-body tab2-card" [formGroup]="editUserForm" (ngSubmit)="updateUser()">
            <!-- <div ngbNav #nav="ngbNav" class="nav-tabs">
                <div [ngbNavItem]="1">
                  <a ngbNavLink>Account</a>
                  <ng-template ngbNavContent>
                    
                  </ng-template>
                </div>
              </div> -->
            <!-- <div [ngbNavOutlet]="nav" class="mt-2"></div> -->
            <div class="needs-validation user-add" novalida>
              <h4>Cập nhật tài khoản</h4>
              <!-- Id -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom0"><span>*</span> ID</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input formControlName="id" class="form-control input-id" type="text" readonly />
                </div>
              </div>
              <!-- avatar -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom0"><span>*</span> Ảnh đại diện</label>
                </div>
                <div class="col-xl-8 col-md-7 ">
                  <div class="d-flex align-items-center">
                    <input #myPhoto class="input-image" formControlName="imageUrl" type="file" accept="image/*" (change)="onFileChange($event)"/>
                    <img class="rounded-circle border border-dark" [src]="avatar" *ngIf="avatar" style="width: 120px; height: 120px; margin-left: 20px;">
                    <img class="rounded-circle border border-dark" src="../../../../assets/images/avatar-default.png" *ngIf="!avatar" style="width: 120px; height: 120px; margin-left: 20px;">
                  </div>
                  <div *ngIf="imageUrl?.invalid && (imageUrl?.dirty || imageUrl?.touched)" class="alert alert-danger mt-1">
                    <div *ngIf="imageUrl?.errors?.['required']">Vui lòng chọn ảnh đại diện.</div>
                  </div>
                </div>
              </div>
              <!-- full name -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom0"><span>*</span> Họ và tên</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input formControlName="fullName" class="form-control" type="text" />
                  <div
                    *ngIf="fullName?.invalid && (fullName?.dirty || fullName?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="fullName?.errors?.['required']">Vui lòng không được bỏ trống tên.</div>
  
                    <div *ngIf="fullName?.errors?.['minlength']">Tên phải có ít nhất 2 kí tự</div>
                  </div>
                </div>
              </div>
              <!-- email -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom2"><span>*</span> Email</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input formControlName="email" class="form-control" type="email" />
                  <div *ngIf="email?.invalid && (email?.dirty || email?.touched)" class="alert alert-danger mt-1">
                    <div *ngIf="email?.errors?.['required']">Vui lòng không được bỏ trống email.</div>
                    <div *ngIf="email?.errors?.email">Email không hợp lệ, vui lòng nhập lại</div>
                  </div>
                </div>
              </div>
              <!-- date of birth -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom2"><span>*</span> Ngày Sinh</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input formControlName="dateOfBirth" class="form-control" type="date" />
                  <div
                    *ngIf="dateOfBirth?.invalid && (dateOfBirth?.dirty || dateOfBirth?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="dateOfBirth?.errors?.['required']">Vui lòng không được bỏ trống ngày sinh.</div>
                  </div>
                </div>
              </div>
              <!-- phone number -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom2"><span>*</span> Số Điện Thoại</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input formControlName="phoneNumber" class="form-control" type="number" />
                  <div
                    *ngIf="phoneNumber?.invalid && (phoneNumber?.dirty || phoneNumber?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="phoneNumber?.errors?.['required']">Vui lòng không được bỏ trống số điện thoại.</div>
                    <div *ngIf="phoneNumber?.errors?.['pattern']">Số điện thoại phải có tối đa 10 số</div>
                  </div>
                </div>
              </div>
              <!-- identified code -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom2"><span>*</span> CMND/CCCD</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <input
                    formControlName="identifiedCode"
                    class="form-control"
                    type="number"
                    placeholder="Số CMNND/CCCD"
                  />
                  <div
                    *ngIf="identifiedCode?.invalid && (identifiedCode?.dirty || identifiedCode?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="identifiedCode?.errors?.['required']">Vui lòng không được bỏ trống CMND/CCCD.</div>
                    <div *ngIf="identifiedCode?.errors?.['pattern']">CMND phải có tối đa 9 số hoặc CCCD phải có tối đa 12 số</div>
                  </div>
                </div>
              </div>
              <!-- address -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom2"><span>*</span>Địa chỉ</label>
                </div>
                <div class="col-xl-8 col-md-7" formArrayName="addresses">
                  <div class="address-form" *ngFor="let address of editUserForm.get('addresses')['controls']; let i = index" [formGroupName]="i">
                    <div class="address-cover">
                      <div class="address-holder">
                        <div class="address-street">
                          <input formControlName="address" class="form-control address-input" type="text" placeholder="Địa chỉ"
                          />
                          <div
                            *ngIf="
                              address.get('address')?.invalid &&
                              (address.get('address')?.dirty || address.get('address')?.touched)
                            "
                            class="alert alert-danger mt-1"
                          >
                            <div *ngIf="address.get('address')?.errors?.['required']">
                              Vui lòng không được bỏ trống địa chỉ.
                            </div>
                          </div>
                        </div>
                        <div class="address-location">
                          <div class="location-district">
                            <select formControlName="district" class="district" (change)="onDistrictChange(i)">
                              <option value="">-- Chọn quận --</option>
                              <option *ngFor="let district of districts" [value]="district.id">
                                {{ district.name }}
                              </option>
                            </select>
                            <div *ngIf="address.get('district')?.invalid && (address.get('district')?.dirty || address.get('district')?.touched)" class="alert alert-danger mt-1">
                              <div *ngIf="address.get('district')?.errors?.['required']">Vui lòng chọn Quận.</div>
                            </div>
                          </div>
                          <div class="location-ward">
                            <select formControlName="ward" class="ward" [id]="'ward-select-' + i" [attr.disabled]="address.get('district').value === '2'">
                              <option value="">-- Chọn phường --</option>
                              <option *ngFor="let ward of getWards(i)" [value]="ward.id">{{ ward.name }}</option>
                            </select>
                            <div *ngIf="address.get('ward')?.invalid && (address.get('ward')?.dirty || address.get('ward')?.touched)" class="alert alert-danger mt-1">
                              <div *ngIf="address.get('ward')?.errors?.['required']">Vui lòng chọn Phường.</div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="icon-holder" *ngIf="editUserForm.get('addresses')['controls'].length > 1" (click)="removeAddress(i)">
                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                      </div>
                    </div>
                    <hr *ngIf="editUserForm.get('addresses')['controls'].length > 1 && i < editUserForm.get('addresses')['controls'].length - 1"
                    />
                  </div>
  
                  <div class="btn btn-green" (click)="addAddress()">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i>
                    Thêm địa chỉ
                  </div>
  
                </div>
                
              </div>
              <!-- password -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom3"><span>*</span> Mật Khẩu mới</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <div class="form-control input-password-holder">
                    <input formControlName="password" class="input-password" type="{{ showPassword ? 'text' : 'password' }}" placeholder="Mật khẩu" />
                    <span class="icon-holder-eye" (click)="showPassword = !showPassword">
                      <i class="{{ showPassword ? 'fa fa-eye-slash' : 'fa fa-eye' }}"></i>
                    </span>
                  </div>
                  <div
                    *ngIf="password?.invalid && (password?.dirty || password?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="password?.errors?.['required']">Vui lòng không được bỏ trống mật khẩu.</div>
                    <div *ngIf="password?.errors?.['pattern']">
                      Mật khẩu phải chứa ít nhất 8 ký tự, trong đó gồm một ký tự số, một chữ hoa, một chữ thường và một ký
                      tự đặc biệt.
                      <br />
                      Mật khẩu không được chứa khoảng trắng.
                    </div>
                  </div>
                </div>
              </div>
              <!-- password confirm -->
              <div class="form-group row">
                <div class="col-xl-3 col-md-4">
                  <label for="validationCustom4"><span>*</span> Xác nhận mật khẩu mới</label>
                </div>
                <div class="col-xl-8 col-md-7">
                  <div class="form-control input-password-holder">
                    <input formControlName="confirmPassword" class="input-password" type="{{ showPassword ? 'text' : 'password' }}" #pwc placeholder="Xác nhận mật khẩu"/>
                    <span class="icon-holder-eye" (click)="showPassword = !showPassword">
                      <i class="{{ showPassword ? 'fa fa-eye-slash' : 'fa fa-eye' }}"></i>
                    </span>
                  </div>
                  <div
                    *ngIf="confirmPassword?.invalid && (confirmPassword?.dirty || confirmPassword?.touched)"
                    class="alert alert-danger mt-1"
                  >
                    <div *ngIf="confirmPassword?.errors?.['required']">Vui lòng xác nhận mật khẩu.</div>
                    <div *ngIf="confirmPassword?.errors?.['pattern']">
                      Mật khẩu phải chứa ít nhất 8 ký tự, trong đó gồm một ký tự số, một chữ hoa, một chữ thường và một ký
                      tự đặc biệt.
                      <br />
                      Mật khẩu không được chứa khoảng trắng.
                    </div>
                    <div *ngIf="confirmPassword?.errors?.['confirmedValidator']">
                      Mật khẩu xác nhận phải giống với mật khẩu đã nhập
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pull-right d-flex justify-content-between" style="width: 22%">
              <button type="submit" class="btn btn-danger" [disabled]="editUserForm.invalid">Cập nhật</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Container-fluid Ends-->
  </div>
  
  
  
  